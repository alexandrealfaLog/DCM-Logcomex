# üì¶ Database Change Management Logcomex
<img alt="DCM" src="assets/img.png" width="300px" height="250px" style="border-radius:20px" align="right"/>
Este reposit√≥rio √© respons√°vel pelo versionamento, revis√£o e execu√ß√£o segura de altera√ß√µes em banco de dados via scripts SQL. O objetivo √© garantir rastreabilidade, controle de altera√ß√µes e revis√£o por pares antes da execu√ß√£o em ambientes sens√≠veis (ex: produ√ß√£o).

---

## üõ†Ô∏è Como funciona'

1. Crie um arquivo `.sql` na pasta `migrations/` seguindo o padr√£o de nomenclatura:
   ```
   YYYY-MM-DD_nome_da_mudanca.sql
   ```
   Exemplo: `2025-06-26_add_trial_plan.sql`

2. Utilize o template padr√£o dispon√≠vel em:
   ```
   templates/migration_template.sql
   ```

3. Submeta um **Pull Request** com:
   - Descri√ß√£o clara da altera√ß√£o proposta
   - Estimativa de impacto (linhas afetadas, tabelas, registros, etc.)
   - Avalia√ß√£o de riscos (ex: duplicidade, integridade referencial, etc.)
   - Marca√ß√£o dos revisores necess√°rios (`@dba`, `@techlead`, `@arquiteto`)

4. Ap√≥s aprova√ß√£o, o script ser√° executado **manualmente por respons√°vel autorizado** ou via **pipeline automatizado**, quando dispon√≠vel.

---

## üîÅ Processo de Submiss√£o

1. **Crie uma nova branch para a altera√ß√£o:**
   ```bash
   git checkout -b feature/2025-06-26-add-trial-plan
   ```

2. **Crie o script `.sql` na pasta `migrations/` baseado no template.**

3. **Preencha os metadados no cabe√ßalho do SQL.**  
   Exemplo:
   ```sql
   -- ========================================
   -- Autor: Alexandre Alfa
   -- Database: db-api
   -- Data: 2025-06-26
   -- Objetivo: Inserir plano trial do produto X
   -- Produto: Service ID 44 (nome do servi√ßo)
   -- Impacto estimado: ~500 linhas em customer_plan
   -- Riscos: Evitar duplicidade de planos j√° ativos
   -- ========================================
   ```

4. **Crie um Pull Request contendo:**
   - T√≠tulo descritivo (ex: `feat: inserir trial para clientes sem plano ativo`)
   - Corpo explicando o que ser√° alterado e por qu√™
   - Marque os revisores t√©cnicos e operacionais necess√°rios (`@dba`, `@techlead`)

5. **Execu√ß√£o do script:**
   - Acontece **somente ap√≥s aprova√ß√£o formal**.
   - A execu√ß√£o ser√° registrada com o n√∫mero do PR ou commit hash para auditoria futura.

---

## ‚úÖ Boas pr√°ticas

- Nunca envie `DELETE` ou `UPDATE` sem cl√°usula `WHERE`.
- Teste previamente seus scripts em ambiente de desenvolvimento.
- Sempre que poss√≠vel, utilize `SELECT` de valida√ß√£o antes de `INSERT`.
- Preencha o cabe√ßalho com **objetivo, impacto e riscos** claramente.
- Prefira `SELECT 1` em subqueries com `EXISTS`/`NOT EXISTS`.
- Use transa√ß√µes (`BEGIN; COMMIT;`) quando fizer m√∫ltiplas altera√ß√µes relacionadas.

---

## üìÅ Estrutura recomendada

```plaintext
migrations/
‚îú‚îÄ‚îÄ 2025-06-26_add_trial_plan.sql
‚îú‚îÄ‚îÄ 2025-06-18_update_customer_status.sql
‚îî‚îÄ‚îÄ ...
templates/
‚îî‚îÄ‚îÄ migration_template.sql
.github/
‚îî‚îÄ‚îÄ pull_request_template.md
README.md
```

---

## üöÄ Futuras melhorias

- Integra√ß√£o com GitHub Actions para valida√ß√£o de sintaxe SQL
- Execu√ß√£o automatizada via pipeline (CI/CD)
- Suporte a m√∫ltiplos bancos (`db-core`, `db-analytics`, etc.)

---

Para d√∫vidas, sugest√µes ou melhorias, fale com o time de dados ou arquitetura.  
**Respons√°vel t√©cnico:** @alexandre-alfa
